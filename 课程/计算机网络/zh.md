# 知识点
## 缩写与简称
ISP：Internet Service Provider, Internet服务提供商
TCP/IP: Transmission Control Protocol/Internet Protocol, 传输控制协议／互联网协议
- PDU: Protocol Data Unit, 协议数据单元。每一层传输的数据单位，例如传输层的segment/user datagram, 网络层的packet, 数据链路层的frame, 物理层的bit，都叫做PDU.
DHCP: Dynamic Host Configuration Protocol, 动态主机配置协议
ARP: Address Resolution Protocol, 地址解析协议
IP: Internet Protocol, Internet协议
MTU: maximum transfer unit, 最大传输单元
CSMA/CD: carrier sense multiple access with collision detection, 带冲突检测的载波侦听多路访问
LAN: Local Area Network
WAN: Wide Area Network
MAN: 
MTU(Maximum Transmission Unit, 最大传输单元)
面向连接服务(Connection-oriented Service)
无连接服务(Connectionless Service)


Layer:
peer:
## 概论
点到点网络与交换式网络
交换式网络有两种常见类型：电路交换(Circuit Switching)和分组交换(Packet Switching)
电路交换：比如电话系统，拨号连接，打电话上网二选一，童年回忆
不同点对比：
电路交换是连续通信，分组交换是利用独立的数据分组来通信
一直连着

Ethernet协议
### 协议分层
应用层: 为应用进程提供服务，包括HTTP, SMTP, FTP等
传输层: 负责向两个主机中进程间的通信提供服务，包括TCP, UDP等
网络层: 负责为分组交换网上的不同主机提供通信服务。将传输层下传的segment或user datagram封装成packet
数据链路层: 专注于两个相邻结点的通信，将网络层下传的IP packet组装成frame并传送
物理层: 传输bit




TCP/IP模型：物理层、数据链路层、网络层、传输层、应用层
OSI模型：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
不同设备的同层内容是对等的
网络层：负责在源计算机和目的计算机之间创建一个连接，网络层的通信是主机到主机的
数据链路层：把数据报封装成帧
物理层：数据转换为物理信号，负责携带一个帧中单独的比特穿过链路
传输介质层

物理层的数据交换单元是一个比特，绝对没有地址
分组名 | 层次 | 地址
--- | --- | ---
消息 | 应用层 | 名字
段／用户数据报 | 传输层 | 端口号
数据报 | 网络层 | 逻辑地址
帧 | 数据链路层 | 链路层地址
比特 | 物理层 | 

网络层、数据链路层都起封装作用


低层协议为高层协议提供的服务：面向连接的和无连接的
分组交换(Packet Switching)和电路交换(Circuit Switching)

汉明码是一种线性调试码

多路复用Multiplexing：一个协议能够封装来自多个上层协议的分组。一条数据链路同时传输多个信号。
模拟信号：频分多路复用、波分多路复用
数字信号：时分多路复用


时分多路复用：类似CPU时间片


## 物理层
物理层的通信是点对点的，交换电磁信号。

任务是将bit转换为电磁信号

## 数据链路层
数据链路层的通信是结点到结点的。

发送方：把网络层下传的IP数据报添加首尾封装成帧，传给接收方。
接收方：若收到的帧无差错，从中解封IP数据报，上交给网络层。

### 封装成帧
数据链路层将把数据下传给物理层，而物理层传输的是比特流，那么数据链路层有责任把比特流转换成帧，所以需要制订帧头和帧尾来表示一帧的开始和结束。帧头和帧尾的定义均是ASCII码中的不可见字符，分别为`SOH`(0x01)和`EOT`(0x04)，为了服务后续内容，帧头往往还带有控制信息。

### MAC帧
- 目的地址 6字节
- 源地址 6字节
- 类型 2字节
- 数据
- FCS 4字节

### CSMA/CD协议
载波监听多点接入/碰撞检测

- 多点接入: 许多计算机以多点接入的方式连接在一根总线上。
- 载波监听: 发送前先监听，如果总线有其他站在发送数据，等待。
- 碰撞检测: 边发边监听，检测信号电压变化，当多个站发送数据时，信号电压变化幅度会增大，超过阈值就停止发送，等待随机时间再次发送。

### 透明传输
用于控制的字符在文本中是肯定见不到的，但是其他格式的数据（音频、图像）的二进制恰好与控制字符一样的时候，接收方就搞不清楚该怎么做了，就如同字符串中的特殊字符一样，要在“控制字符”前加转义字符`ESC`来表明它不是真的控制字符。同样的，就像字符串中用`\\`来表示转义字符`\`，这里也会用两个转义字符`ESC`来表示其实数据里真的包含一个0x1B。这种方法被称为字节填充(byte stuffing)或字符填充(character stuffing)。

### 差错控制
数据链路层的对等传输实际依赖于物理层，物理层可能会出现差错，0变成1或者1变成0。

CRC(Cyclic Redundancy Check, 循环冗余检验)
任务是
Logical Link Control，逻辑链路控制
DLC与MAC

### DLC
### MAC
先听后发，边发边听，冲突停发，随机延迟后重发
纯ALOHA 只要有帧要发送，就发送

### 链路层寻址
ARP协议定义在网络层
## 网络层
发送方: 
接收方: 

### 地址解析协议ARP与逆地址解析协议RARP
IP地址->ARP->物理地址
物理地址->RARP->IP地址

在主机的ARP cache里存着本局域网内IP地址到硬件地址的映射表
当发送方向**本局域网**的接收方发送IP数据报时，先在ARP cache里查看有无接收方的IP地址，有的话就能得到对应的硬件地址，写入MAC帧。没有的话，运行ARP。

在局域网广播发送一个ARP请求packet，表明：“我的IP地址是xxxx，我的硬件地址是yyyy，我想知道IP地址为xxxx的硬件地址”

本局域网的所有主机运行的ARP进程收到这个packet，接收方就会向发送方发送ARP响应 packet。

为了减少以获得硬件地址为目的的通信，首先设计了ARP cache，其次ARP请求packet把自身的IP地址和硬件地址都广播了出去，这样接收方主机B（很有可能接下来就会给主机A发消息）就有了主机A的IP地址与硬件地址映射。

如果是不同网络，发送方主机A会将数据报所在网络的路由器（可能用到ARP），由路由器完成剩下工作。

IP数据报报头：
- 固定部分(20字节):
    - 4位版本：广泛使用的有IPv4(0x4)和IPv6(0x6)
    - 4位首部长度：单位为32位字(一个32位字长为4字节)，所以首部最多为60字节，不足4字节的整数倍时会利用最后的填充字段填充。
    - 8位区分服务：根据数chong据qian类duo型shao提供不同服务。
    - 16位总长度：首部+数据的总长度，单位为字节，故最大长度是2^16-1字节。当分片时，总长度指分片后该片的总长度。
    - 16位标识(identification): 当数据报需要分片时，接收方可以把相同标识字段的片重新组装。
    - 3位标志(flag): 最低位MF(More Fragment)，MF=1表明后面还有分片，反之表明这是最后一个分片；中间位DF(Don't Fragment)，DF=0表明可以分片。
    - 13位片偏移: 当数据报分片时，片偏移表明在原分组中的相对位置。片偏移以8个字节为偏移单位，所以每个分片长度一定是8字节的整数倍。
    - 8位生存时间(TTL, Time To Live): 以防数据报在网络中兜圈子浪费网络资源而设计。每经过一个路由器，TTL减去对应时间。后来改为按跳计数，那么：最多经过255个路由器，TTL=1表明只能在本局域网传输。
    - 8位协议: 指出此数据报使用什么协议。接收方根据本字段决定把数据上交给哪个协议。
    - 16位首部检验和: 
    - 32位源地址
    - 32位目标地址

- 可变部分(最多40字节)：

### 转发分组
路由表
目的网络地址 子网掩码 下一跳地址

#### 转发的过程
从数据报首部提取目标地址D，得目的网络地址N
若此路由器与N相连，直接交付（把D转换为硬件地址，数据报封装成MAC帧，发送此帧）。
否则，执行转发：
优先级为：特定主机路由 > 可到达网络N的路由 > 默认路由
最后没辙了，报告这里有一个无家可归的数据报。


#### 路由选择算法

通信双方的网络层把
源端：从上层（传输层）接收分组，封装，传递到下层（数据链路层）
目的端：从下层（数据链路层）接收分组，解封并传递到相应的上层（传输层），如果分组被分段，由网络层负责等待，重组。
DHCP: 帮助IP获取一台主机的网络层地址
ARP: 帮助IP寻找一台主机或一台路由器的链路层地址
路由：从源端到目的端有多个路由器，网络层负责寻找最佳的路由。
转发：决策表
forwarding table
routing table
无连接服务
面向连接服务


# 应用层
DNS: The Domain Name System


# 编码
# 计算题／算法详解
## Hamming码
### 编码

### 译码
Hamming以实现差错控制
为保证检测出s个差错，最小汉明距离必须是s+1
2k-1≥n+k

海明码的校验码的位置必须是在2^n次方位置（n从0 开始，分别代表从左边数起分别是第1、2、4、8、16……），信息码也就是在非2^n次方位置
## CRC编码
### 编码
1. 确定校验码位数
2. 确定校验码位置

3. 确定校验码
校验位置选择原则：第i位校验码从当前校验码位开始，每次连续校验i位后再跳过i位，然后再连续校验i位，再跳过i位，以此类推。确定每个校验码所校验的比特位：
第1位校验码位于新的编码的第1位(2 ^(1-1) == 1)（汉明码从1位开始），计算1,3,5,7,9,11,13,15,...位的异或，填入新的编码的第1位。
第2位校验码位于新的编码的第2位(2 ^(2-1) == 2)，计算2,3,6,7,10,11,14,15,...位的异或，填入新的编码的第2位。
第3位校验码位于新的编码的第4位(2 ^(3-1) == 4)，计算4,5,6,7,12,13,14,15,20,21,22,23,...位的异或，填入新的编码的第4位。
第4位校验码位于新的编码的第8位(2 ^(4-1) == 8)，计算8-15,24-31,40-47,...位的异或，填入新的编码的第8位。
第5位校验码位于新的编码的第16位(2 ^(5-1) == 16)，计算16-31,48-63,80-95,...位的异或，填入新的编码的第16位。

### 译码
根据编码规则，接收方在收到编码后数据后，提取data bits，check bits
### 题型

## 传输延迟计算


## 传输计算


## 传输层
网络层为主机之间提供逻辑服务，而运输层为应用进程之间提供端到端的逻辑通信。

复用和分发: 发送方应用层所有的应用进程都通过传输层送到IP层，接收方也会交付给不同的应用进程
### UDP
#### 首部格式
- 源端口 2字节
- 目的端口 2字节
- 长度 2字节，仅计算首部
- 检验和 2字节


### TCP
- 源端口 2字节
- 目的端口 2字节
- 序号 4字节
- 确认号 4字节, 期望收到对方下一个报文段的第一个数据字节的序号。
- 数据偏移 4位
- 保留 6位
- 窗口 2字节
- 检验和 2字节
- 紧急指针 2字节
选项，长度可变，最长40字节

#### 流量控制
流量控制(flow control): 解决
拥塞控制()


#### 停止等待协议
每发送完一个分组就等待确认
连续ARQ协议

字段|长度|意义
---|---|---
源端口|2字节|
目的端口|2字节|
长度|2字节|仅计算首部
检验和|2字节|


中间设备所在层次
物理层: repeater
数据链路层: bridge
网络层: router
网络层以上: gateway


分类IP地址，每8位用十进制数字表示
IP地址
<网络号><主机号>，分等级
A类 8位网络号(以0开头) + 24位主机号
B类 16位网络号(以10开头) + 16位主机号
C类 24位网络号(以110开头) + 8位主机号
D类 以1110开头，后面为多播地址
E类 以1111开头，保留

近年的路由选择都在使用无分类IP地址

<网络号><子网号><主机号>


子网掩码
IP数据报的首部是没有子网划分信息的，
32位，网络号和子网号的部分是1，主机号的部分是0
把子网掩码与数据报中目的IP地址作`AND`运算，得到子网的网络地址


IP地址类别
看网络号的范围:
A类 8位(以0开头)
B类 16位(以10开头)
C类 24位(以110开头)

## CRC


## 汉明码
设将要进行检测的二进制代码为n位，为使其具有**纠错**能力，需要再加上k位的检测位，组成n+k位的代码。那么，新增加的检测位数k应满足：

2k≥n+k+1或2k-1≥n+k

在新的编码的$2^(k - 1)( k >= 0)$位上填入0（即校验位）
把新的编码的其余位把源码按原顺序填入
校验位的编码方式为：第k位校验码从则从新的编码的第$2^(k - 1)$位开始，每计算$2^(k - 1)$位的异或，跳$2^(k - 1)$位，再计算下一组$2^(k - 1)$位的异或，填入$2^(k - 1)$位